<!-- Override attachShadow BEFORE Google Maps loads to style the autocomplete -->
<script nonce="<%= content_security_policy_nonce %>">
(function() {
  const attachShadow = Element.prototype.attachShadow;
  
  Element.prototype.attachShadow = function(init) {
    // Check if this is the Google Places autocomplete element
    if (this.localName === 'gmp-place-autocomplete') {
      // Override to open mode so we can inject styles
      const shadow = attachShadow.call(this, {
        ...init,
        mode: 'open'
      });
      
      const style = document.createElement('style');
      
      // Apply custom styles to match your form inputs exactly
      style.textContent = `
        .widget-container {
          border: none !important;
        }
        
        .input-container {
          border: 1px solid rgb(209, 213, 219) !important;
          border-radius: 0 !important;
          background-color: white !important;
          box-shadow: none !important;
        }
        
        .input-container:focus-within {
          border-color: #1a1a1a !important;
          box-shadow: 0 0 0 1px #1a1a1a !important;
        }
        
        .focus-ring {
          display: none !important;
        }
        
        input {
          font-family: 'Montserrat', sans-serif !important;
          font-size: 1rem !important;
          line-height: 1.5rem !important;
          color: #1a1a1a !important;
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          margin: 0 !important;
          outline: none !important;
        }
        
        input::placeholder {
          color: #9ca3af !important;
        }
      `;
      
      shadow.appendChild(style);
      return shadow;
    }
    
    // For other elements, use default behavior
    return attachShadow.call(this, init);
  };
})();
</script>

<section class="py-20 bg-[#f8f5f0] min-h-screen">
  <div class="max-w-4xl mx-auto px-8">
    
    <a href="/membership">
      <span class="inline-flex items-center text-gray-700 hover:text-gray-900 font-montserrat text-sm uppercase">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        Back
      </span>
    </a>

    <div class="text-center mb-12 mt-8">
      <h2 class="text-4xl md:text-5xl tracking-[0.1em] font-light mb-4 font-austin text-gray-900">
        MEMBERSHIP APPLICATION
      </h2>
      <p class="text-gray-600 text-sm tracking-[0.2em] uppercase font-montserrat">
        Tell us about yourself
      </p>
    </div>

    <%= form_with model: @member || Member.new, url: membership_apply_path, method: :post, data: { controller: "membership-form form-validation", membership_form_storage_key_value: "room13_membership_application" }, class: "space-y-12", novalidate: true do |f| %>
      
      <!-- Hidden field for membership type -->
      <%= f.hidden_field :membership_type, value: params[:membership_type] || 'community' %>
      
      <!-- Personal Details Section -->
      <div class="bg-white p-8 shadow-sm">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-6 font-austin text-gray-900 border-b border-gray-200 pb-3">
          YOUR DETAILS
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <%= f.label :first_name, "First Name *", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :first_name, 
                required: true,
                placeholder: "John",
                value: params[:first_name],
                data: { 
                  membership_form_target: "input", 
                  form_validation_target: "field",
                  action: "input->membership-form#saveForm blur->form-validation#validateField" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            <p class="text-red-600 text-sm mt-1 hidden" data-form-validation-target="error"></p>
            <% if @member&.errors&.include?(:first_name) %>
              <p class="text-red-600 text-sm mt-1"><%= @member.errors[:first_name].first %></p>
            <% end %>
          </div>

          <div>
            <%= f.label :last_name, "Last Name *", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :last_name, 
                required: true,
                placeholder: "Doe",
                value: params[:last_name],
                data: { 
                  membership_form_target: "input", 
                  form_validation_target: "field",
                  action: "input->membership-form#saveForm blur->form-validation#validateField" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            <p class="text-red-600 text-sm mt-1 hidden" data-form-validation-target="error"></p>
            <% if @member&.errors&.include?(:last_name) %>
              <p class="text-red-600 text-sm mt-1"><%= @member.errors[:last_name].first %></p>
            <% end %>
          </div>

          <div>
            <%= f.label :title, "Title", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :title, 
                placeholder: "e.g. Dr, Prof, Sir, Dame",
                data: { 
                  membership_form_target: "input", 
                  action: "input->membership-form#saveForm" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
          </div>

          <div>
            <%= f.label :nickname, "What should we call you?", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :nickname, 
                placeholder: "What should we call you?",
                data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
          </div>

          <div>
            <%= f.label :email, "Email *", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.email_field :email, 
                required: true,
                placeholder: "john@example.com",
                value: params[:email],
                data: { 
                  membership_form_target: "input", 
                  form_validation_target: "field",
                  action: "input->membership-form#saveForm blur->form-validation#validateField" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            <p class="text-red-600 text-sm mt-1 hidden" data-form-validation-target="error"></p>
            <% if @member&.errors&.include?(:email) %>
              <p class="text-red-600 text-sm mt-1"><%= @member.errors[:email].first %></p>
            <% end %>
          </div>

          <div>
            <%= f.label :phone_number, "Phone Number *", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.telephone_field :phone_number, 
                required: true,
                placeholder: "+1 (555) 123-4567",
                data: { 
                  membership_form_target: "input", 
                  form_validation_target: "field",
                  action: "input->membership-form#saveForm blur->form-validation#validateField" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            <p class="text-red-600 text-sm mt-1 hidden" data-form-validation-target="error"></p>
            <% if @member&.errors&.include?(:phone_number) %>
              <p class="text-red-600 text-sm mt-1"><%= @member.errors[:phone_number].first %></p>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Address Section -->
      <div class="bg-white p-8 shadow-sm" data-controller="address-autocomplete" data-address-autocomplete-api-key-value="<%= Rails.application.credentials.google_cloud[:api_key] %>">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-6 font-austin text-gray-900 border-b border-gray-200 pb-3">
          ADDRESS
        </h3>
        
        <div class="mb-6">
          <label class="block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2">
            Search Address
          </label>
          <input 
            type="text" 
            data-address-autocomplete-target="search"
            placeholder="Start typing your address..."
            class="w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" />
          <p class="text-gray-500 text-xs mt-1 font-montserrat">Begin typing to search and select your address</p>
        </div>

        <div data-address-autocomplete-target="addressFields" class="space-y-6">
          <div>
            <%= f.label :address_line_1, "Address Line 1", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :address_line_1, 
                placeholder: "123 Main Street",
                data: { 
                  address_autocomplete_target: "addressLine1",
                  membership_form_target: "input", 
                  action: "input->membership-form#saveForm" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
          </div>

          <div>
            <%= f.label :address_line_2, "Address Line 2", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
            <%= f.text_field :address_line_2, 
                placeholder: "Apt 4B (optional)",
                data: { 
                  address_autocomplete_target: "addressLine2",
                  membership_form_target: "input", 
                  action: "input->membership-form#saveForm" 
                },
                class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <%= f.label :city, "City / Locality", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
              <%= f.text_field :city, 
                  placeholder: "New York",
                  data: { 
                    address_autocomplete_target: "city",
                    membership_form_target: "input", 
                    action: "input->membership-form#saveForm" 
                  },
                  class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            </div>

            <div>
              <%= f.label :state, "State / Province / Region", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
              <%= f.text_field :state, 
                  placeholder: "NY",
                  data: { 
                    address_autocomplete_target: "state",
                    membership_form_target: "input", 
                    action: "input->membership-form#saveForm" 
                  },
                  class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <%= f.label :postal_code, "Postal / ZIP Code", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
              <%= f.text_field :postal_code, 
                  placeholder: "10001",
                  data: { 
                    address_autocomplete_target: "postalCode",
                    membership_form_target: "input", 
                    action: "input->membership-form#saveForm" 
                  },
                  class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            </div>

            <div>
              <%= f.label :country, "Country", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
              <%= f.select :country, 
                  [
                    ["United States", "United States"],
                    ["United Kingdom", "United Kingdom"],
                    ["France", "France"],
                    ["Germany", "Germany"],
                    ["Italy", "Italy"],
                    ["Switzerland", "Switzerland"],
                    ["Spain", "Spain"],
                    ["Netherlands", "Netherlands"],
                    ["Belgium", "Belgium"],
                    ["Austria", "Austria"],
                    ["---", "---"],
                    ["Afghanistan", "Afghanistan"],
                    ["Albania", "Albania"],
                    ["Algeria", "Algeria"],
                    ["Andorra", "Andorra"],
                    ["Angola", "Angola"],
                    ["Argentina", "Argentina"],
                    ["Armenia", "Armenia"],
                    ["Australia", "Australia"],
                    ["Azerbaijan", "Azerbaijan"],
                    ["Bahrain", "Bahrain"],
                    ["Bangladesh", "Bangladesh"],
                    ["Belarus", "Belarus"],
                    ["Bhutan", "Bhutan"],
                    ["Bolivia", "Bolivia"],
                    ["Bosnia and Herzegovina", "Bosnia and Herzegovina"],
                    ["Brazil", "Brazil"],
                    ["Brunei", "Brunei"],
                    ["Bulgaria", "Bulgaria"],
                    ["Cambodia", "Cambodia"],
                    ["Canada", "Canada"],
                    ["Chile", "Chile"],
                    ["China", "China"],
                    ["Colombia", "Colombia"],
                    ["Costa Rica", "Costa Rica"],
                    ["Croatia", "Croatia"],
                    ["Cuba", "Cuba"],
                    ["Cyprus", "Cyprus"],
                    ["Czech Republic", "Czech Republic"],
                    ["Denmark", "Denmark"],
                    ["Dominican Republic", "Dominican Republic"],
                    ["Ecuador", "Ecuador"],
                    ["Egypt", "Egypt"],
                    ["El Salvador", "El Salvador"],
                    ["Estonia", "Estonia"],
                    ["Ethiopia", "Ethiopia"],
                    ["Finland", "Finland"],
                    ["Georgia", "Georgia"],
                    ["Ghana", "Ghana"],
                    ["Greece", "Greece"],
                    ["Guatemala", "Guatemala"],
                    ["Honduras", "Honduras"],
                    ["Hong Kong", "Hong Kong"],
                    ["Hungary", "Hungary"],
                    ["Iceland", "Iceland"],
                    ["India", "India"],
                    ["Indonesia", "Indonesia"],
                    ["Iran", "Iran"],
                    ["Iraq", "Iraq"],
                    ["Ireland", "Ireland"],
                    ["Israel", "Israel"],
                    ["Jamaica", "Jamaica"],
                    ["Japan", "Japan"],
                    ["Jordan", "Jordan"],
                    ["Kazakhstan", "Kazakhstan"],
                    ["Kenya", "Kenya"],
                    ["Kuwait", "Kuwait"],
                    ["Kyrgyzstan", "Kyrgyzstan"],
                    ["Laos", "Laos"],
                    ["Latvia", "Latvia"],
                    ["Lebanon", "Lebanon"],
                    ["Libya", "Libya"],
                    ["Liechtenstein", "Liechtenstein"],
                    ["Lithuania", "Lithuania"],
                    ["Luxembourg", "Luxembourg"],
                    ["Macau", "Macau"],
                    ["Madagascar", "Madagascar"],
                    ["Malaysia", "Malaysia"],
                    ["Maldives", "Maldives"],
                    ["Malta", "Malta"],
                    ["Mexico", "Mexico"],
                    ["Monaco", "Monaco"],
                    ["Mongolia", "Mongolia"],
                    ["Montenegro", "Montenegro"],
                    ["Morocco", "Morocco"],
                    ["Myanmar", "Myanmar"],
                    ["Nepal", "Nepal"],
                    ["New Zealand", "New Zealand"],
                    ["Nicaragua", "Nicaragua"],
                    ["Nigeria", "Nigeria"],
                    ["North Macedonia", "North Macedonia"],
                    ["Norway", "Norway"],
                    ["Oman", "Oman"],
                    ["Pakistan", "Pakistan"],
                    ["Palestine", "Palestine"],
                    ["Panama", "Panama"],
                    ["Paraguay", "Paraguay"],
                    ["Peru", "Peru"],
                    ["Philippines", "Philippines"],
                    ["Poland", "Poland"],
                    ["Portugal", "Portugal"],
                    ["Qatar", "Qatar"],
                    ["Romania", "Romania"],
                    ["Russia", "Russia"],
                    ["Saudi Arabia", "Saudi Arabia"],
                    ["Senegal", "Senegal"],
                    ["Serbia", "Serbia"],
                    ["Singapore", "Singapore"],
                    ["Slovakia", "Slovakia"],
                    ["Slovenia", "Slovenia"],
                    ["South Africa", "South Africa"],
                    ["South Korea", "South Korea"],
                    ["Sri Lanka", "Sri Lanka"],
                    ["Sweden", "Sweden"],
                    ["Syria", "Syria"],
                    ["Taiwan", "Taiwan"],
                    ["Tajikistan", "Tajikistan"],
                    ["Tanzania", "Tanzania"],
                    ["Thailand", "Thailand"],
                    ["Tunisia", "Tunisia"],
                    ["Turkey", "Turkey"],
                    ["Turkmenistan", "Turkmenistan"],
                    ["Uganda", "Uganda"],
                    ["Ukraine", "Ukraine"],
                    ["United Arab Emirates", "United Arab Emirates"],
                    ["Uruguay", "Uruguay"],
                    ["Uzbekistan", "Uzbekistan"],
                    ["Venezuela", "Venezuela"],
                    ["Vietnam", "Vietnam"],
                    ["Yemen", "Yemen"],
                    ["Zambia", "Zambia"],
                    ["Zimbabwe", "Zimbabwe"]
                  ],
                  { include_blank: "Select a country" },
                  data: { 
                    address_autocomplete_target: "country",
                    membership_form_target: "input", 
                    action: "change->membership-form#saveForm" 
                  },
                  class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Professional Section -->
      <div class="bg-white p-8 shadow-sm">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-6 font-austin text-gray-900 border-b border-gray-200 pb-3">
          PROFESSION
        </h3>
        
        <div>
          <%= f.label :occupation, "Occupation", class: "block text-sm tracking-[0.1em] uppercase font-montserrat text-gray-700 mb-2" %>
          <%= f.text_field :occupation, 
              placeholder: "",
              data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
              class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
        </div>
      </div>

      <!-- Art Events Section -->
      <div class="bg-white p-8 shadow-sm">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-6 font-austin text-gray-900 border-b border-gray-200 pb-3">
          ART CITIES YOU FREQUENTLY ATTEND
        </h3>

        <%#
          Art cities grouped by continent and sorted alphabetically within each group.
          Structure: { "Continent" => [ [Label, Value], ... ] }
        %>
        <%
          art_cities_by_region = {
            "Asia Pacific" => [
              ["Bangkok", "bangkok"],
              ["Beijing", "beijing"],
              ["Dhaka", "dhaka"],
              ["Hong Kong", "hong_kong"],
              ["Kathmandu", "kathmandu"],
              ["Kochi", "kochi"],
              ["Mumbai", "mumbai"],
              ["New Delhi", "new_delhi"],
              ["Seoul", "seoul"],
              ["Singapore", "singapore"],
              ["Sydney", "sydney"],
              ["Tokyo", "tokyo"],
            ].sort,
            "Europe, Arabia and Africa" => [
              ["Abu Dhabi", "abu_dhabi"],
              ["Amsterdam", "amsterdam"],
              ["Antwerp", "antwerp"],
              ["Athens", "athens"],
              ["Basel", "basel"],
              ["Berlin", "berlin"],
              ["Brussels", "brussels"],
              ["Cape Town", "cape_town"],
              ["Copenhagen", "copenhagen"],
              ["Dusseldorf", "dusseldorf"],
              ["Doha", "doha"],
              ["Dubai", "dubai"],
              ["Ibiza", "ibiza"],
              ["Istanbul", "istanbul"],
              ["Johannesburg", "johannesburg"],
              ["Kassel", "kassel"],
              ["Lagos", "lagos"],
              ["London", "london"],
              ["Maastricht", "maastricht"],
              ["Madrid", "madrid"],
              ["Marrakech", "marrakech"],
              ["Milan", "milan"],
              ["Munich", "munich"],
              ["Paris", "paris"],
              ["St. Moritz", "st_moritz"],
              ["Stockholm", "stockholm"],
              ["Turin", "turin"],
              ["Venice", "venice"],
              ["Warsaw", "warsaw"],
              ["Zurich", "zurich"]
            ].sort,
            "North, Central and South America" => [
              ["Buenos Aires", "buenos_aires"],
              ["Lima", "lima"],
              ["Sao Paulo", "sao_paulo"],
              ["Punta del Este", "punta_del_este"],
              ["Aspen", "aspen"],
              ["Dallas", "dallas"],
              ["Chicago", "chicago"],
              ["Miami", "miami"],
              ["Toronto", "toronto"],
              ["Vancouver", "vancouver"],
              ["San Francisco", "san_francisco"],
              ["Los Angeles", "los_angeles"],
              ["Mexico City", "mexico_city"],
              ["New York", "new_york"]
            ].sort
          }
        %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% art_cities_by_region.each do |region, cities| %>
            <div class="col-span-1 md:col-span-2">
              <div class="font-montserrat text-xs uppercase font-semibold tracking-wider text-gray-500 pt-4 pb-1"><%= region %></div>
            </div>
            <% cities.each do |label, value| %>
              <div class="flex items-start">
                <%= check_box_tag "member[additional_responses][art_events][]", value, false,
                    data: { membership_form_target: "input", action: "change->membership-form#saveForm" },
                    id: "art_event_#{value}",
                    class: "mt-1 h-4 w-4 text-gray-900 border-gray-300 focus:ring-gray-900" %>
                <%= label_tag "art_event_#{value}", label, class: "ml-3 text-sm tracking-[0.05em] font-montserrat text-gray-700" %>
              </div>
            <% end %>
          <% end %>
      </div>
      </div>

      <!-- Art fairs you are a VIP -->
      <div class="bg-white p-8 shadow-sm mb-8">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-3 font-austin text-gray-900 border-b border-gray-200 pb-3">
          YOUR VIP STATUS
        </h3>
        <label for="member_additional_responses_art_fairs_vip" class="block text-sm tracking-[0.05em] font-montserrat text-gray-700 mb-2">
          Please include any art fairs or clubs you are a member/vip of
        </label>
        <%= text_area_tag "member[additional_responses][vip_status]", nil,
              data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
              placeholder: "E.g.\nArt Basel – VIP cardholder\nFrieze – Collectors Circle\nTEFAF – VIP\nThe Arts Club – member\nSoho House – member",
              rows: 6,
              class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat resize-none" %>
      </div>

      <!-- Why Join Room 13 Section -->
      <div class="bg-white p-8 shadow-sm">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-3 font-austin text-gray-900 border-b border-gray-200 pb-3">
          WHY ROOM 13?
        </h3>
        <label for="member_additional_responses_membership_goals" class="block text-sm tracking-[0.05em] font-montserrat text-gray-700 mb-2">
          What would you like to get out of your membership?
        </label>
        <%= text_area_tag "member[additional_responses][membership_goals]", nil,
              rows: 5,
              data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
              class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat resize-none" %>
      </div>

      <!-- Proust Questions Section -->
      <div class="bg-white p-8 shadow-sm">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-6 font-austin text-gray-900 border-b border-gray-200 pb-3">
          PERSONAL QUESTIONS
        </h3>
        
        <p class="text-gray-600 text-sm tracking-[0.1em] font-montserrat mb-6 italic">
          Inspired by Proust and Max Frisch's Questionnaire
        </p>

        <div class="space-y-6">
          <% proust_questions = [
            ["What do you most value in your friends?", "value_in_friends"],
            ["What is your most treasured possession?", "treasured_possession"],
            ["When and where were you happiest?", "happiest_moment"],
            ["What is your motto?", "motto"]
          ] %>

          <% proust_questions.each do |question, key| %>
            <div>
              <%= label_tag "member_additional_responses_#{key}", question, class: "block text-sm tracking-[0.05em] font-montserrat text-gray-700 mb-2" %>
              <%= text_area_tag "member[additional_responses][proust_questions][#{key}]", nil,
                  rows: 3,
                  data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
                  placeholder: "Your answer...",
                  class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat resize-none" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- How Did You Hear About Us Section -->
      <div class="bg-white p-8 shadow-sm" data-controller="referral-source">
        <h3 class="text-2xl tracking-[0.15em] font-light mb-3 font-austin text-gray-900 border-b border-gray-200 pb-3">
          HOW DID YOU HEAR ABOUT US?
        </h3>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">
          <% referral_sources = [
            ["Friend or Family", "friend_family"],
            ["Social Media", "social_media"],
            ["Press or Article", "press"],
            ["Art Fair or Event", "art_fair"],
            ["Gallery", "gallery"],
            ["Other", "other"]
          ] %>

          <% referral_sources.each do |label, value| %>
            <label class="flex items-center justify-center px-4 py-3 border border-gray-300 cursor-pointer transition-all duration-200 hover:border-gray-900 has-[:checked]:bg-gray-900 has-[:checked]:text-white has-[:checked]:border-gray-900">
              <%= radio_button_tag "member[additional_responses][referral_source]", value, false,
                  data: {
                    membership_form_target: "input",
                    action: "change->membership-form#saveForm change->referral-source#toggle",
                    referral_source_target: "radio"
                  },
                  class: "sr-only" %>
              <span class="text-sm tracking-[0.05em] font-montserrat"><%= label %></span>
            </label>
          <% end %>
        </div>

        <div class="mt-4 hidden" data-referral-source-target="otherField">
          <%= label_tag "member_additional_responses_referral_source_other", "Please tell us more", class: "block text-sm tracking-[0.05em] font-montserrat text-gray-700 mb-2" %>
          <%= text_field_tag "member[additional_responses][referral_source_other]", nil,
              data: { membership_form_target: "input", action: "input->membership-form#saveForm" },
              placeholder: "How did you hear about Room 13?",
              class: "w-full px-4 py-3 border border-gray-300 focus:border-gray-900 focus:ring-1 focus:ring-gray-900 outline-none transition-colors font-montserrat" %>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-center pt-4">
        <%= f.submit "Submit Application", 
            data: { 
              action: "click->membership-form#clearStorage click->form-validation#validateAll",
              form_validation_target: "submit"
            },
            class: "px-16 py-4 bg-gray-900 text-white tracking-[0.2em] uppercase font-montserrat text-sm hover:bg-gray-800 transition-colors duration-300 cursor-pointer" %>
        <p class="text-red-600 text-sm mt-4 hidden" data-form-validation-target="submitError">
          Please correct the errors above before submitting
        </p>
        <p class="text-gray-500 text-xs mt-4 font-montserrat">
          * Required fields
        </p>
        <p class="text-gray-500 text-xs mt-2 font-montserrat">
          Your progress is automatically saved
        </p>
      </div>

    <% end %>

  </div>
</section>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.google_cloud[:api_key] %>&libraries=places&callback=Function.prototype&loading=async" async defer></script>